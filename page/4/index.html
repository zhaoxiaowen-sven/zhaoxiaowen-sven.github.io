<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Sven&#39;s blog">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="Sven&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="sven">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Sven's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
      <a target="_blank" rel="noopener" href="https://github.com/zhaoxiaowen-sven" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sven's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/22/Notes/Android/FourComponents/BroadcastReceiver%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sven.jpeg">
      <meta itemprop="name" content="sven">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sven's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/22/Notes/Android/FourComponents/BroadcastReceiver%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-22 23:06:56" itemprop="dateCreated datePublished" datetime="2021-02-22T23:06:56+08:00">2021-02-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="BroadcastReceiver-基础知识"><a href="#BroadcastReceiver-基础知识" class="headerlink" title="BroadcastReceiver 基础知识"></a>BroadcastReceiver 基础知识</h1><p>BroadcastReceiver 四大组件之一，主要用于监听手机状态的变以及不同组件和应用间的通信。</p>
<h2 id="一-注册广播"><a href="#一-注册广播" class="headerlink" title="一.注册广播"></a>一.注册广播</h2><h3 id="1-静态注册："><a href="#1-静态注册：" class="headerlink" title="1.静态注册："></a>1.静态注册：</h3><ol>
<li><p>在AndroidMainfest中添加receiver</p>
<pre><code> &lt;receiver android:name=&quot;.MyReceiver&quot;&gt;
     &lt;intent-filter&gt;
         &lt;action android:name=&quot;android.intent.action.myreceiver&quot; /&gt;
     &lt;/intent-filter&gt;
 &lt;/receiver&gt;
</code></pre>
</li>
<li><p>创建类继承BroadcastReceiver的，并且复写onReceive()方法</p>
<pre><code> public class MyReceiver extends BroadcastReceiver &#123;
     @Override
     public void onReceive(Context context, Intent intent) &#123;
         Log.i(TAG, &quot;receive action &quot;);
     &#125;
 &#125;
</code></pre>
</li>
</ol>
<h3 id="2-动态注册"><a href="#2-动态注册" class="headerlink" title="2. 动态注册"></a>2. 动态注册</h3><ol>
<li><p>创建广播类和实例</p>
</li>
<li><p>创建intentFilter并且添加需要接收的action</p>
</li>
<li><p>调用registerReceiver方法注册</p>
</li>
<li><p>可以通过unregisterReceiver取消</p>
<pre><code> public class MainActivity extends Activity &#123;
     private BroadcastReceiver mBroadcastReceiver;
 
     @Override
     protected void onCreate(Bundle savedInstanceState) &#123;
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_main);
 
         mBroadcastReceiver = new MyBroadcastReceiver();
         IntentFilter intentFilter = new IntentFilter();
         intentFilter.addAction(&quot;MyIntent&quot;);
         registerReceiver(mBroadcastReceiver, intentFilter);
     &#125;
     @Override
     protected void onDestroy() &#123;
         super.onDestroy();
         unregisterReceiver(mBroadcastReceiver);
     &#125;
 &#125;
</code></pre>
</li>
</ol>
<p>###Tips：</p>
<ol>
<li>action的注册和解注册成对出现在context对应的生命周期中，例如onCreate和onDestroy，以及onResume和onPause</li>
<li>同一个receiver可以同时接收动态注册和静态注册的广播</li>
<li>动态广播在应用没有启动时，是无法接收到的，即使加了Intent.FLAG_INCLUDE_STOPPED_PACKAGES（测试失败）</li>
</ol>
<h2 id="二、广播的类型"><a href="#二、广播的类型" class="headerlink" title="二、广播的类型"></a>二、广播的类型</h2><p>###1. 系统广播<br>   系统广播，当手机状态发生变化时，都会发出相应的系统广播。如：网络状态，解锁等。注意：有些系统广播必须态注册才有效：SCREEN_ON，SCREEN_OFF<br>###2. 普通广播<br>   自定义的广播，通常用于应用内或应用间通信。<br>###3. 有序广播</p>
<ol>
<li>多个具当前已经注册且有效的BroadcastReceiver接收有序广播时，是按照先后顺序接收的，先后顺序判定标准为：将当前系统中所有有效的动态注册和静态注册的BroadcastReceiver按照priority属性值从大到小排序，对于具有相同的priority的动态广播和静态广播，动态广播会排在前面。<pre><code> &lt;receiver android:name=&quot;.OrderedReceiver1&quot;&gt;
     &lt;intent-filter android:priority=&quot;100&quot;&gt;
         &lt;action android:name=&quot;com.sven.action.my.receiver.orderd.receiver&quot; /&gt;
     &lt;/intent-filter&gt;
 &lt;/receiver&gt;
 &lt;receiver android:name=&quot;.OrderedReceiver2&quot;&gt;
     &lt;intent-filter android:priority=&quot;1000&quot;&gt;
         &lt;action android:name=&quot;com.sven.action.my.receiver.orderd.receiver&quot; /&gt;
     &lt;/intent-filter&gt;
 &lt;/receiver&gt;
</code></pre>
</li>
</ol>
<p> 当然动态注册时也可以设置优先级：</p>
<pre><code>    intentFilter.setPriority(1000);
</code></pre>
<ol start="2">
<li><p>先接收的BroadcastReceiver可以对此有序广播进行截断，使后面的BroadcastReceiver不再接收到此广播，</p>
<pre><code> public class OrderedReceiver2 extends BroadcastReceiver &#123;
     private static final String TAG = &quot;OrderedReceiver2&quot;;
     @Override
     public void onReceive(Context context, Intent intent) &#123;
         Log.i(TAG, &quot;action = &quot;+intent.getAction());
         abortBroadcast();
     &#125;
 &#125;
</code></pre>
</li>
<li><p>receiver之间的通信<br>优先接收到Broadcast的Receiver可通过setResultExtras(Bundle)方法将处理结果存入Broadcast中，下一个Receiver 可通过getResultExtras(true)方法获取上一个 Receiver传来的数据。</p>
<pre><code> //修改
 public class OrderedReceiver2 extends BroadcastReceiver &#123;
     private static final String TAG = &quot;OrderedReceiver2&quot;;
     @Override
     public void onReceive(Context context, Intent intent) &#123;
         Log.i(TAG, &quot;action = &quot;+intent.getAction());
         Bundle b = new Bundle();
         b.putInt(&quot;value&quot;, 101);
         setResultExtras(b);
     &#125;
 &#125;
 
 //接收    
 public class OrderedReceiver1 extends BroadcastReceiver &#123;
     private static final String TAG = &quot;OrderedReceiver1&quot;;
     @Override
     public void onReceive(Context context, Intent intent) &#123;
         Log.i(TAG, &quot;action = &quot;+intent.getAction());
         Bundle b = getResultExtras(true);
         Log.i(TAG,&quot;value = &quot;+b.get(&quot;value&quot;));
     &#125;
 &#125;
</code></pre>
</li>
</ol>
<p>##三、广播和权限</p>
<h3 id="1-谁有权限接收-和安装的顺序有关-需要先装发送者"><a href="#1-谁有权限接收-和安装的顺序有关-需要先装发送者" class="headerlink" title="1. 谁有权限接收 (和安装的顺序有关 需要先装发送者)"></a>1. 谁有权限接收 (和安装的顺序有关 需要先装发送者)</h3><ol>
<li>发送者的manifest声明权限<pre><code> &lt;permission android:name=&quot;com.sven.permission.my.receiver.RECEIVE&quot;/&gt;
</code></pre>
</li>
<li>发送时添加权限<pre><code> public void sendBroadcast(View view) &#123;
     sendBroadcast(new Intent(&quot;com.sven.action.my.receiver&quot;),
             &quot;com.sven.permission.my.receiver.RECEIVE&quot;);
 &#125;
</code></pre>
</li>
<li>接收app的manifest要添加对应的权限<pre><code> &lt;uses-permission android:name=&quot;com.sven.permission.my.receiver.RECEIVE&quot;/&gt;
</code></pre>
</li>
</ol>
<h3 id="2-谁有权限发送-（和安装顺序有关，先安装接收者）"><a href="#2-谁有权限发送-（和安装顺序有关，先安装接收者）" class="headerlink" title="2. 谁有权限发送 （和安装顺序有关，先安装接收者）"></a>2. 谁有权限发送 （和安装顺序有关，先安装接收者）</h3><ol>
<li><p>接收者的manifest文件中声明权限</p>
<pre><code>    &lt;permission android:name=&quot;com.sven.permission.my.receiver.SEND&quot;/&gt;
</code></pre>
</li>
<li><p>接收者的receiver节点中添加</p>
<pre><code>     &lt;receiver
         android:name=&quot;.MyReceiverWithPermission&quot;
         android:permission=&quot;com.sven.permission.my.receiver.SEND&quot;&gt;
         &lt;intent-filter&gt;
         ....
         &lt;/intent-filter&gt;
     &lt;/receiver&gt;
</code></pre>
</li>
<li><p>发送者的manifest文件中使用</p>
<pre><code> &lt;uses-permission android:name=&quot;com.sven.permission.my.receiver.SEND&quot;/&gt;
</code></pre>
</li>
</ol>
<h3 id="Tips："><a href="#Tips：" class="headerlink" title="Tips："></a>Tips：</h3><p>自定义的权限最好在2个app中同时声明，（测试出现了比较奇怪的情况，声明权限的app，必须先安装，否则还是会报权限问题），使用系统权限不会不存在以上问题</p>
<h3 id="四、安全高效地使用广播的一些原则："><a href="#四、安全高效地使用广播的一些原则：" class="headerlink" title="四、安全高效地使用广播的一些原则："></a>四、安全高效地使用广播的一些原则：</h3><ol>
<li><p>如果不需要发送到应用外，同一个应用内的广播尽量使用LocalBroadcastManager</p>
</li>
<li><p>尽量使用动态注册的广播，而且有些系统广播，比如说 CONNECTIVITY_ACTION 在7.0之后只能通过动态注册接收</p>
</li>
<li><p>发送广播时明确广播的接受者：<br> (1)发送时添加权限<br> (2)通过setPackage 指定应用<br> (3)使用LocalBroadcastManager</p>
</li>
<li><p>广播的命名尽量保证唯一</p>
</li>
<li><p>注册一个广播时，限制广播的接收者：</p>
<p> (1)添加一个权限, mainfest 中指定，动态注册可以使用该接口添加权限</p>
<pre><code> public abstract Intent registerReceiver(BroadcastReceiver receiver, IntentFilter filter, String broadcastPermission, Handler scheduler);
</code></pre>
<p> (2)仅仅只是应用内使用时，可以使用设置 android:exported=”false”。这样就不会接收应用外的广播了<br> (3)使用LocalBroadcastManager</p>
</li>
<li><p>onReceive方法运行在主线程中，所以不能执行耗时任务</p>
</li>
<li><p>不要通过广播启动activity，可以使用通知替代</p>
</li>
</ol>
<p>五、onReceive<br>系统执行onReceive方法时，receiver会被当成前台进程，不会被杀，但是当onReceive()方法返回后，会被当成一个低优先级的程序，很容易被系统杀掉，在onReceive执行耗时异步任务时，最好通过goAsync防止执行过程中被系统杀掉。<br>onReceive 的context是Application的context？？？</p>
<pre><code>public class MyBroadcastReceiver extends BroadcastReceiver &#123;
    private static final String TAG = &quot;MyBroadcastReceiver&quot;;
    @Override
    public void onReceive(final Context context, final Intent intent) &#123;
        final PendingResult pendingResult = goAsync();
        AsyncTask&lt;String, Integer, String&gt; asyncTask = new AsyncTask&lt;String, Integer, String&gt;() &#123;
            @Override
            protected String doInBackground(String... params) &#123;
                StringBuilder sb = new StringBuilder();
                sb.append(&quot;Action: &quot; + intent.getAction() + &quot;\n&quot;);
                sb.append(&quot;URI: &quot; + intent.toUri(Intent.URI_INTENT_SCHEME).toString() + &quot;\n&quot;);
                Log.d(TAG, log);
                // Must call finish() so the BroadcastReceiver can be recycled.
                pendingResult.finish();
                return data;
            &#125;
        &#125;;
        asyncTask.execute(); 
&#125;
</code></pre>
<p>}<br>###Tips:<br>可以在通过一下这种方法让onReceive执行在handlerThread中。</p>
<pre><code>private Handler handler; // Handler for the separate Thread
HandlerThread handlerThread = new HandlerThread(&quot;MyNewThread&quot;);
handlerThread.start();
// Now get the Looper from the HandlerThread so that we can create a Handler that is  attached to the HandlerThread
// NOTE: This call will block until the HandlerThread gets control and initializes its Looper
Looper looper = handlerThread.getLooper();
// Create a handler for the service
handler = new Handler(looper);
// Register the broadcast receiver to run on the separate Thread
registerReceiver (myReceiver, intentFilter, broadcastPermission, handler);
</code></pre>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/10682241/register-a-broadcast-receiver-from-a-service-in-a-new-thread">https://stackoverflow.com/questions/10682241/register-a-broadcast-receiver-from-a-service-in-a-new-thread</a></p>
<h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h2><ol>
<li>有哪些静态广播可以启动进程，是否有其他要求？</li>
<li>上文提到的发送及接收时permission的问题？</li>
<li>BroadcastReceiver 耗时任务通过开启service执行和异步执行各有什么应用场景？</li>
</ol>
<p>参考资料：<br><a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/broadcasts.html#security_considerations_and_best_practices">https://developer.android.com/guide/components/broadcasts.html#security_considerations_and_best_practices</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/lwbqqyumidi/p/4168017.html">http://www.cnblogs.com/lwbqqyumidi/p/4168017.html</a></p>
<p>Demo：<br><a target="_blank" rel="noopener" href="http://download.csdn.net/detail/time_traveller14/9892205">http://download.csdn.net/detail/time_traveller14/9892205</a><br><a target="_blank" rel="noopener" href="http://download.csdn.net/detail/time_traveller14/9892207">http://download.csdn.net/detail/time_traveller14/9892207</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/22/Notes/Android/FourComponents/Android%20Activity%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%90%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sven.jpeg">
      <meta itemprop="name" content="sven">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sven's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/22/Notes/Android/FourComponents/Android%20Activity%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%90%86%E8%A7%A3/" class="post-title-link" itemprop="url">NET_01_HTTP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-22 23:02:47" itemprop="dateCreated datePublished" datetime="2021-02-22T23:02:47+08:00">2021-02-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Android-Activity生命周期和启动模式理解"><a href="#Android-Activity生命周期和启动模式理解" class="headerlink" title="Android Activity生命周期和启动模式理解"></a>Android Activity生命周期和启动模式理解</h1><h1 id="一、生命周期"><a href="#一、生命周期" class="headerlink" title="一、生命周期"></a>一、生命周期</h1><h2 id="1-正常情况下生命周期分析"><a href="#1-正常情况下生命周期分析" class="headerlink" title="1.正常情况下生命周期分析"></a>1.正常情况下生命周期分析</h2><p><img src="https://leanote.com/api/file/getImage?fileId=594635f1ab64413c78001121" alt="Activity的生命周期"><br>完整生命周期：onCreate -&gt; onDestroy<br>可见生命周期：onStart -&gt; onStop<br>前台生命周期: onResume -&gt; onPause</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="2-常见生命周期的区别"><a href="#2-常见生命周期的区别" class="headerlink" title="2.常见生命周期的区别"></a>2.常见生命周期的区别</h2><h3 id="1-onCreate-和-onStart"><a href="#1-onCreate-和-onStart" class="headerlink" title="1. onCreate 和 onStart"></a>1. onCreate 和 onStart</h3><p>（1）可见与不可见的区别。前者不可见，后者可见。<br>（2）onCreate方法只在Activity创建时执行一次，而onStart方法在Activity的切换以及按Home键返回桌面再切回应用的过程中被多次调用。</p>
<h3 id="2-onStart-和-onRestart"><a href="#2-onStart-和-onRestart" class="headerlink" title="2.onStart 和 onRestart"></a>2.onStart 和 onRestart</h3><p>如果一个activity第一次创建，那么只会走onStart，如果是切换应用或者桌面，那么就会走onRestart<br>If it’s destroyed onCreate(.) &gt;  onStart(.) &gt; onResume(.) is called(variables are lost, redraw).<br>If it’s stopped onRestart(.) &gt; onStart(.) &gt; onResume(.) is called(variables are not lost, redraw)</p>
<h3 id="3-onStart-和-onResume"><a href="#3-onStart-和-onResume" class="headerlink" title="3.onStart 和 onResume"></a>3.onStart 和 onResume</h3><p>onStart activity 可见，不在前台<br>onResume activity 可见，前台且可与用户交互<br>这2个的主要区别就是Activity此时是否可以与用户交互</p>
<h3 id="4-onPause-和-onStop"><a href="#4-onPause-和-onStop" class="headerlink" title="4.onPause 和 onStop"></a>4.onPause 和 onStop</h3><p>这2个状态通常是配对执行的，<br>有一种情况是特殊的，新启动的Activity是一个透明的界面，那么第一个Activity执行onPause后，onStop是不会调用的</p>
<pre><code>&lt;activity android:name=&quot;.SecondActivity&quot;
    android:theme=&quot;@style/Theme.AppCompat.Dialog&quot; /&gt;
</code></pre>
<h3 id="5-onStop-amp-onDestroy"><a href="#5-onStop-amp-onDestroy" class="headerlink" title="5.onStop &amp; onDestroy"></a>5.onStop &amp; onDestroy</h3><p>onStop阶段Activity还没有被销毁，对象还在内存中，此时可以通过切换Activity再次回到该Activity，而onDestroy阶段Activity被销毁</p>
<h3 id="tips："><a href="#tips：" class="headerlink" title="tips："></a>tips：</h3><p>不同的生命周期适合不同的资源初始化或者释放工作，实践和工作中多总结。<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/fb44584daee3">http://www.jianshu.com/p/fb44584daee3</a></p>
<h2 id="3-常见操作的生命周期"><a href="#3-常见操作的生命周期" class="headerlink" title="3.常见操作的生命周期"></a>3.常见操作的生命周期</h2><h3 id="1-Launcher点击启动"><a href="#1-Launcher点击启动" class="headerlink" title="1.Launcher点击启动"></a>1.Launcher点击启动</h3><pre><code>01-16 10:57:22.429 26845-26845/? I/ActivityLife: onCreate...
01-16 10:57:22.429 26845-26845/? I/ActivityLife: onStart...
01-16 10:57:22.429 26845-26845/? I/ActivityLife: onResume...
</code></pre>
<h3 id="2-back键退出"><a href="#2-back键退出" class="headerlink" title="2.back键退出"></a>2.back键退出</h3><pre><code>01-16 10:58:58.139 26845-26845/? I/ActivityLife: onPause...
01-16 10:58:58.459 26845-26845/? I/ActivityLife: onStop...
01-16 10:58:58.459 26845-26845/? I/ActivityLife: onDestroy...
</code></pre>
<h3 id="3-HOME键退出然后再次点击启动"><a href="#3-HOME键退出然后再次点击启动" class="headerlink" title="3.HOME键退出然后再次点击启动"></a>3.HOME键退出然后再次点击启动</h3><pre><code>01-16 10:59:49.019 26845-26845/? I/ActivityLife: onPause...
01-16 10:59:49.309 26845-26845/? I/ActivityLife: onStop...
01-16 11:00:06.519 26845-26845/? I/ActivityLife: onRestart...
01-16 11:00:06.519 26845-26845/? I/ActivityLife: onStart...
01-16 11:00:06.519 26845-26845/? I/ActivityLife: onResume...
</code></pre>
<h3 id="4-锁屏解锁"><a href="#4-锁屏解锁" class="headerlink" title="4.锁屏解锁"></a>4.锁屏解锁</h3><pre><code>01-16 11:02:33.739 26845-26845/? I/ActivityLife: onPause...
01-16 11:02:33.779 26845-26845/? I/ActivityLife: onStop...
01-16 11:02:35.509 26845-26845/? I/ActivityLife: onRestart...
01-16 11:02:35.529 26845-26845/? I/ActivityLife: onStart...
01-16 11:02:35.529 26845-26845/? I/ActivityLife: onResume...
</code></pre>
<h1 id="2-异常情况下的生命周期分析"><a href="#2-异常情况下的生命周期分析" class="headerlink" title="2.异常情况下的生命周期分析"></a>2.异常情况下的生命周期分析</h1><h2 id="1-触发情况："><a href="#1-触发情况：" class="headerlink" title="1.触发情况："></a>1.触发情况：</h2><p>1.系统资源相关的配置发生变化导致Activity被杀死和重建<br>2.系统内存资源不足，lmk</p>
<h2 id="2-执行的特殊生命周期："><a href="#2-执行的特殊生命周期：" class="headerlink" title="2.执行的特殊生命周期："></a>2.执行的特殊生命周期：</h2><pre><code>onSaveInstanceState &amp; onRestoreInstanceState
</code></pre>
<p>1.onSaveInstanceState 通常在onStop之前，用于保存Activity数据<br>2.onRestoreInstanceState 通常在onStart之后，恢复Activity数据 </p>
<h3 id="tips：-1"><a href="#tips：-1" class="headerlink" title="tips："></a>tips：</h3><p>在onCreate和onRestoreInstanceState中都有一个参数savedInstanceState，二者的区别是：onRestoreInstanceState的参数是一定有值的，我们不用额外的判断它是否为空，但是onCreate不行，onCreate如果正常启动的话，savedInstanceState的值是null</p>
<h2 id="3-典型示例，系统配置变化，屏幕旋转"><a href="#3-典型示例，系统配置变化，屏幕旋转" class="headerlink" title="3.典型示例，系统配置变化，屏幕旋转"></a>3.典型示例，系统配置变化，屏幕旋转</h2><pre><code>public class MainActivity extends AppCompatActivity &#123;

    private static final String TAG = &quot;ActivityLife&quot;;

    private static final String EDIT_TAG = &quot;edit_tag&quot;;
    private EditText editText;

    @Override
    protected void onSaveInstanceState(Bundle outState) &#123;
        Log.i(TAG, &quot;onSaveInstanceState...&quot;);
        super.onSaveInstanceState(outState);
        String s = editText.getText().toString();
        outState.putString(EDIT_TAG,s);
    &#125;

    @Override
    protected void onRestoreInstanceState(Bundle savedInstanceState) &#123;
        super.onRestoreInstanceState(savedInstanceState);
        Log.i(TAG, &quot;onRestoreInstanceState...&quot;);
        //onCreate 或者这里恢复数据均可
        editText.setText(savedInstanceState.getString(EDIT_TAG));
    &#125;

    @Override
    protected void onCreate(Bundle savedInstanceState) &#123;
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Log.i(TAG, &quot;onCreate...&quot;);
        editText = (EditText) findViewById(R.id.edit_content);
        if (savedInstanceState != null)&#123;
            Log.i(TAG, &quot;onCreate savedInstanceState is not null&quot;);
            editText.setText(savedInstanceState.getString(EDIT_TAG));
        &#125;
    &#125;
&#125;
</code></pre>
<p>从Lanucher启动并且旋转一次屏幕，生命周期如下：</p>
<pre><code>01-16 11:59:30.459 29726-29726/? I/ActivityLife: onCreate...
01-16 11:59:30.459 29726-29726/? I/ActivityLife: onStart...
01-16 11:59:30.459 29726-29726/? I/ActivityLife: onResume...
01-16 11:59:38.609 29726-29726/? I/ActivityLife: onPause...
01-16 11:59:38.609 29726-29726/? I/ActivityLife: onSaveInstanceState...
01-16 11:59:38.619 29726-29726/? I/ActivityLife: onStop...
01-16 11:59:38.619 29726-29726/? I/ActivityLife: onDestroy...
01-16 11:59:38.669 29726-29726/? I/ActivityLife: onCreate...
01-16 11:59:38.669 29726-29726/? I/ActivityLife: onCreate savedInstanceState is not null
01-16 11:59:38.669 29726-29726/? I/ActivityLife: onStart...
01-16 11:59:38.669 29726-29726/? I/ActivityLife: onRestoreInstanceState...
01-16 11:59:38.669 29726-29726/? I/ActivityLife: onResume...
</code></pre>
<h2 id="4-onConfigurationChanged"><a href="#4-onConfigurationChanged" class="headerlink" title="4.onConfigurationChanged"></a>4.onConfigurationChanged</h2><p>当系统配置发生变化，如果不希望Activity重新创建，可以在AndroidManifest文件中给Activity加上属性，以屏幕旋转为例</p>
<pre><code>android:configChanges=&quot;orientation|screenSize&quot;
</code></pre>
<p>注意：从 Android 3.2（API 级别 13）开始，当设备在纵向和横向之间切换时，“屏幕尺寸”也会发生变化。因此，在开发针对 API 级别 13 或更高版本（正如 minSdkVersion 和 targetSdkVersion 属性中所声明）的应用时，若要避免由于设备方向改变而导致运行时重启，则除了 “orientation” 值以外，您还必须添加 “screenSize” 值。 也就是说，您必须声明 android:configChanges=”orientation|screenSize”。</p>
<h3 id="configChanges相关属性"><a href="#configChanges相关属性" class="headerlink" title="configChanges相关属性"></a>configChanges相关属性</h3><p><img src="https://leanote.com/api/file/getImage?fileId=59464bb1ab64413e9800127c" alt="config_changes"></p>
<h1 id="二、Activity的启动模式"><a href="#二、Activity的启动模式" class="headerlink" title="二、Activity的启动模式"></a>二、Activity的启动模式</h1><h2 id="1-Activity的四种启动模式"><a href="#1-Activity的四种启动模式" class="headerlink" title="1.Activity的四种启动模式"></a>1.Activity的四种启动模式</h2><p>standard:标准模式，每次启动一个Activity都会重新创建一个新的实例，不管这个实例是否已经存在<br>singleTop:栈顶复用模式，如果新的Activity已经位于任务栈的栈顶，那么此Activity就不会被重新创建,同时他的onNewIntent方法会被回调<br>singleTask:栈内复用模式，如果一个Activity在一个任务栈内存在，那么多次启动这个Activity都不会重新创建实例，它的onNewIntent方法也会被回调<br>singleInstance：单实例模式，具有此种模式的Activity只能单独的位于一个任务栈中</p>
<p>standard 和 singleTop都比较好理解，下面主要分析下singleTask和singleInstance的特点。会用到的调试命令：</p>
<pre><code>adb shell dumpsys activity | grep com.example.sven.activitydemo
</code></pre>
<h2 id="2-singleTask的特点"><a href="#2-singleTask的特点" class="headerlink" title="2.singleTask的特点"></a>2.singleTask的特点</h2><p>​    </p>
<h3 id="1-singleTask-和-taskAffinity"><a href="#1-singleTask-和-taskAffinity" class="headerlink" title="1.singleTask 和 taskAffinity"></a>1.singleTask 和 taskAffinity</h3><p><strong>1.launchMode=singleTask 的应用启动时是否会创建新的任务和taskAffinity属性有关</strong></p>
<p>设置了”singleTask”启动模式的Activity，它在启动的时候，会先在系统中查找属性值affinity等于它的属值taskAffinity的任务存在；如果存在这样的任务，它就会在这个任务中启动，否则就会在新任务中启动。因此如果我们想要设置了”singleTask”启动模式的Activity在新的任务中启动，就要为它设置一个唯一的taskAffinity属性值。</p>
<p>示例：A应用中，A0（表示启动界面，A1跳转的第二个界面，依次类推）A0-A1<br>(1)设置SecondActivity launchMode=”singleTask”，但不指定taskAffinity</p>
<pre><code>TaskRecord&#123;576dbde #53 A=com.example.sven.activitydemo U=0 sz=2&#125;
    Run #5: ActivityRecord&#123;dc04be8 u0 com.example.sven.activitydemo/.SecondActivity t53&#125;
    Run #4: ActivityRecord&#123;bebf9d2 u0 com.example.sven.activitydemo/.MainActivity t53&#125;
</code></pre>
<p>可以看到，虽然设置了singleTask的lanuchModel，但是MainActivity和SecondActivity还是在同一个任务栈中</p>
<p>(2)设置SecondActivity launchMode=”singleTask” ，同时指定taskAffinity = “com.example.sven.activitydemo.second”</p>
<pre><code>TaskRecord&#123;705495 #55 A=com.example.sven.activitydemo.second U=0 sz=1&#125;
    Run #5: ActivityRecord&#123;5a9b163 u0 com.example.sven.activitydemo/.SecondActivity t55&#125;
TaskRecord&#123;9d799aa #54 A=com.example.sven.activitydemo U=0 sz=1&#125;
    Run #4: ActivityRecord&#123;5e9adf5 u0 com.example.sven.activitydemo/.MainActivity t54&#125;
</code></pre>
<p>可以看到，设置了taskAffinity后，新的Activity就运行在新的任务栈里了</p>
<h3 id="tips：-2"><a href="#tips：-2" class="headerlink" title="tips："></a>tips：</h3><p>默认情况下，所有Activity的所需任务栈名均为包名，所以说如果将上面的taskAffinity属性设置为包名，SecondActivity也是不会在新的任务栈中启动的</p>
<p><strong>2.在同一个任务栈中具有唯一性</strong><br>    如果设置了”singleTask”启动模式的Activity不是在新的任务中启动时，它会在已有的任务中查看是否已经存在对应的Activity实例，如果存在，就会把位于这个Activity实例上面的Activity全部结束掉，最终这个Activity实例位于任务的堆栈顶端中。<br>示例：<br>MainActity SecondActivty ThirdActivty（以上3个Activity用A、B、C代表）在2种条件下执行如下过程 A -&gt; B -&gt;C -&gt; A -&gt;B</p>
<p>(1) SecondActivty launchMode=”singleTask”，taskAffinity=包名，最终栈中的结果如下</p>
<pre><code>TaskRecord&#123;8d620aa #62 A=com.example.sven.activitydemo U=0 sz=2&#125;
    Run #5: ActivityRecord&#123;ab051c1 u0 com.example.sven.activitydemo/.SecondActivity t62&#125;
    Run #4: ActivityRecord&#123;56fcc63 u0 com.example.sven.activitydemo/.MainActivity t62&#125;
</code></pre>
<p>(2) 设置SecondActivty 指定 taskAffinity = “com.example.sven.activitydemo.second”</p>
<pre><code>  TaskRecord&#123;4e4a3bc #61 A=com.example.sven.activitydemo.second U=0 sz=1&#125;
    Run #5: ActivityRecord&#123;f48dc2b u0 com.example.sven.activitydemo/.SecondActivity t61&#125;
  TaskRecord&#123;ea52f45 #60 A=com.example.sven.activitydemo U=0 sz=1&#125;
    Run #4: ActivityRecord&#123;9e4ab1 u0 com.example.sven.activitydemo/.MainActivity t60&#125;
</code></pre>
<p>   可以看到在2种情况下， 不论是否设定taskAffinity，在SecondActivity栈顶的实例都被清掉了</p>
<p><strong>3.任务（Task）不仅可以跨应用（Application），还可以跨进程（Process）</strong></p>
<p>示例：<br>    2个应用中A,B中，2个ActivityA1,B1的singleTask的Activity的taskAffinity设置为相同，执行如下过程 A0-&gt;A1，B0-&gt;B1</p>
<pre><code>android:launchMode=&quot;singleTask&quot;
android:taskAffinity=&quot;com.example.sven.activitydemo.second&quot;

TaskRecord&#123;a412e6e #71 A=com.example.sven.activitydemo.second U=0 sz=2&#125;
    Run #5: ActivityRecord&#123;12bc505 u0 com.example.sven.activitydemo2/.SecondActivityCopy t71&#125;
  TaskRecord&#123;fa790f #72 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
    Run #4: ActivityRecord&#123;2610bd9 u0 com.example.sven.activitydemo2/.MainActivityCopy t72&#125;
  TaskRecord&#123;a412e6e #71 A=com.example.sven.activitydemo.second U=0 sz=2&#125;
    Run #3: ActivityRecord&#123;ca0064a u0 com.example.sven.activitydemo/.SecondActivity t71&#125;
  TaskRecord&#123;c224d9c #70 A=com.example.sven.activitydemo U=0 sz=1&#125;
    Run #2: ActivityRecord&#123;4257b8e u0 com.example.sven.activitydemo/.MainActivity t70&#125;
</code></pre>
<p>可以看到相同taskAffinity的Run#5和Run#3是在同一个任务栈a412e6e中的。</p>
<h3 id="tips"><a href="#tips" class="headerlink" title="tips:"></a>tips:</h3><p>Application，Task和Process的区别与联系<br>application翻译成中文时一般称为“应用”或“应用程序”，在android中，总体来说一个应用就是一组组件的集合。<br>task是在程序运行时，只针对activity的概念。说白了，task是一组相互关联的activity的集合，它是存在于framework层的一个概念，控制界面的跳转和返回。这个task存在于一个称为backstack的数据结构中，也就是说，framework是以栈的形式管理用户开启的activity。这个栈的基本行为是，当用户在多个activity之间跳转时，执行压栈操作，当用户按返回键时，执行出栈操作。<br>process一般翻译成进程，进程是操作系统内核中的一个概念，表示直接受内核调度的执行单位。在应用程序的角度看，我们用java编写的应用程序，运行在dalvik虚拟机中，可以认为一个运行中的dalvik虚拟机实例占有一个进程，所以，在默认情况下，一个应用程序的所有组件运行在同一个进程中。但是这种情况也有例外，即，应用程序中的不同组件可以运行在不同的进程中。只需要在manifest中用process属性指定组件所运行的进程的名字。如下所示：</p>
<pre><code> &lt;activity
        android:name=&quot;.SecondActivityCopy&quot;
       android:process=&quot;:remote&quot;
        android:allowTaskReparenting=&quot;true&quot; /&gt;
</code></pre>
<p><strong>4.allowTaskReparenting</strong><br>    一个应用A启动另一个应用B的B1（standard模式）Activity，如果这个Activity的allowTaskReparenting属性为true的话，那么B启动后B1直接会转移到B的任务栈中。现象就是A启动B1，在启动B时，显示的就是B1，而不是B0</p>
<pre><code>A -&gt; B1：

TaskRecord&#123;fc84b0d #46 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
    Run #1: ActivityRecord&#123;8ebbcf3 u0 com.example.sven.activitydemo2/.SecondActivityCopy t46&#125;
  TaskRecord&#123;137b068 #45 A=com.example.sven.activitydemo U=0 sz=1&#125;
    Run #0: ActivityRecord&#123;b7827ad u0 com.example.sven.activitydemo/.MainActivity t45&#125;
</code></pre>
<p>​<br>​<br>​    启动B<br>​    TaskRecord{fc84b0d #46 A=com.example.sven.activitydemo2 U=0 sz=1}<br>​        Run #1: ActivityRecord{8ebbcf3 u0 com.example.sven.activitydemo2/.SecondActivityCopy t46}<br>​      TaskRecord{137b068 #45 A=com.example.sven.activitydemo U=0 sz=1}<br>​        Run #0: ActivityRecord{b7827ad u0 com.example.sven.activitydemo/.MainActivity t45}</p>
<h2 id="4-SingleInstance的特点"><a href="#4-SingleInstance的特点" class="headerlink" title="4.SingleInstance的特点"></a>4.SingleInstance的特点</h2><p><strong>1.singleInstance模式启动的Activity具有全局唯一性</strong><br>    整个系统中只会存在一个这样的实例，如果在启动这样的Activity时，已经存在了一个实例，那么会把它所在的任务调度到前台，重用这个实例。</p>
<p>示例：<br>2 个应用A，B，设置**B1 launchMode=”singleInstance”**， 执行如下过程，先B -&gt; B1， 再A0 -&gt;B1</p>
<pre><code>TaskRecord&#123;9b9bb06 #108 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
    Run #3: ActivityRecord&#123;5520232 u0 com.example.sven.activitydemo2/.SecondActivityCopy t108&#125;
TaskRecord&#123;7b4a5c7 #107 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
    Run #2: ActivityRecord&#123;6cf92f7 u0 com.example.sven.activitydemo2/.MainActivityCopy t107&#125;

TaskRecord&#123;9b9bb06 #108 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
    Run #4: ActivityRecord&#123;5520232 u0 com.example.sven.activitydemo2/.SecondActivityCopy t108&#125;
TaskRecord&#123;3cccdb5 #109 A=com.example.sven.activitydemo U=0 sz=1&#125;
    Run #3: ActivityRecord&#123;facfdb u0 com.example.sven.activitydemo/.MainActivity t109&#125;
TaskRecord&#123;7b4a5c7 #107 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
    Run #2: ActivityRecord&#123;6cf92f7 u0 com.example.sven.activitydemo2/.MainActivityCopy t107&#125;
</code></pre>
<p>可以看到 2 个过程中B1 的Taskrecord没有发生变化</p>
<p><strong>2.singleInstance模式启动的Activity具有独占性</strong><br>它会独自占用一个任务，被它开启的任何activity都会运行在其他任务中，但是否能够开启一个新任务，要看当前系统中是不是已经有了一个和要开启的Activity的taskAffinity属性相同的任务。<br>示例：<br>   B0-&gt;B1 B1-&gt;A3（B0和B1又因为上个原则，所以是在不同的任务栈中）</p>
<pre><code>  TaskRecord&#123;94de3cf #69 A=com.example.sven.activitydemo U=0 sz=1&#125;
    Run #2: ActivityRecord&#123;89ba288 u0 com.example.sven.activitydemo/.ThirdActivity t69&#125;
  TaskRecord&#123;2ad415c #68 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
    Run #1: ActivityRecord&#123;73d6ca u0 com.example.sven.activitydemo2/.SecondActivityCopy t68&#125;
  TaskRecord&#123;6d70c65 #67 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
    Run #0: ActivityRecord&#123;3941c44 u0 com.example.sven.activitydemo2/.MainActivityCopy t67&#125;
</code></pre>
<p>先启动A0（A3和A0是运行在同一个栈中）  B0-&gt;B1 B1-&gt;A3</p>
<pre><code>TaskRecord&#123;5db49f9 #71 A=com.example.sven.activitydemo U=0 sz=2&#125;
  Run #3: ActivityRecord&#123;dfea174 u0 com.example.sven.activitydemo/.ThirdActivity t71&#125;
TaskRecord&#123;e7e8d3e #73 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
  Run #2: ActivityRecord&#123;cb12857 u0 com.example.sven.activitydemo2/.SecondActivityCopy t73&#125;
TaskRecord&#123;3f750ec #72 A=com.example.sven.activitydemo2 U=0 sz=1&#125;
  Run #1: ActivityRecord&#123;2efad8b u0 com.example.sven.activitydemo2/.MainActivityCopy t72&#125;
TaskRecord&#123;5db49f9 #71 A=com.example.sven.activitydemo U=0 sz=2&#125;
  Run #0: ActivityRecord&#123;c39fdab u0 com.example.sven.activitydemo/.MainActivity t71&#125;
</code></pre>
<p>可以看到A3（Run #2）会在A0 （Run #5）的任务栈中46bac8a</p>
<h3 id="tips：-3"><a href="#tips：-3" class="headerlink" title="tips："></a>tips：</h3><p>启动时是否开启任务栈，考虑3个点：1.被启动的Activity的launchModel，如果是singleTask要同时考虑它的taskAffinity<br>                                 2.启动Activity的launchmode(singleInstance)<br>                                 3.当前是否有被启动应用的任务栈</p>
<h2 id="4-Activity的flag"><a href="#4-Activity的flag" class="headerlink" title="4.Activity的flag"></a>4.Activity的flag</h2><h3 id="1-Intent-FLAG-ACTIVITY-NEW-TASK"><a href="#1-Intent-FLAG-ACTIVITY-NEW-TASK" class="headerlink" title="1.Intent.FLAG_ACTIVITY_NEW_TASK"></a>1.Intent.FLAG_ACTIVITY_NEW_TASK</h3><p>等价于 launchMode = singleTask</p>
<h3 id="2-Intent-FLAG-ACTIVITY-SINGLE-TOP"><a href="#2-Intent-FLAG-ACTIVITY-SINGLE-TOP" class="headerlink" title="2.Intent.FLAG_ACTIVITY_SINGLE_TOP"></a>2.Intent.FLAG_ACTIVITY_SINGLE_TOP</h3><p>等价于 launchMode = singleTop 设置singleTop 和一起使用taskAffinity ，只有singleTop的效果</p>
<h3 id="3-Intent-FLAG-ACTIVITY-CLEAR-TOP"><a href="#3-Intent-FLAG-ACTIVITY-CLEAR-TOP" class="headerlink" title="3.Intent.FLAG_ACTIVITY_CLEAR_TOP"></a>3.Intent.FLAG_ACTIVITY_CLEAR_TOP</h3><p>检查目标栈中是否有对应的实例，如果有就会将该实例之上的所有栈都清掉<br>    A-&gt;B（正常启动）-&gt;C-&gt;A-&gt;B(clearTop方式启动)<br>    (1) B的launchmode 是standard</p>
<pre><code>TaskRecord&#123;fec37c7 #134 A=com.example.sven.activitydemo U=0 sz=4&#125;
    Run #5: ActivityRecord&#123;91e286b u0 com.example.sven.activitydemo/.MainActivity t134&#125;
    Run #4: ActivityRecord&#123;775d8ae u0 com.example.sven.activitydemo/.ThirdActivity t134&#125;
    Run #3: ActivityRecord&#123;20304d6 u0 com.example.sven.activitydemo/.SecondActivity t134&#125;
    Run #2: ActivityRecord&#123;b049afa u0 com.example.sven.activitydemo/.MainActivity t134&#125;
 
TaskRecord&#123;fec37c7 #134 A=com.example.sven.activitydemo U=0 sz=2&#125;
   Run #3: ActivityRecord&#123;4fdc1db u0 com.example.sven.activitydemo/.SecondActivity t134&#125;
    Run #2: ActivityRecord&#123;b049afa u0 com.example.sven.activitydemo/.MainActivity t134&#125;
</code></pre>
<p>可以看到，如果被启动的SecondActivity的启动模式是standard，那么B会重新创建新的实例并且之前的实例及实例之上的Activity都会出栈，recordid 发生了变化 20304d6 -&gt; 4fdc1db</p>
<pre><code>(2) B的launchmode是singleTask

TaskRecord&#123;249ecaa #135 A=com.example.sven.activitydemo U=0 sz=4&#125;
    Run #5: ActivityRecord&#123;1116cb u0 com.example.sven.activitydemo/.MainActivity t135&#125;
    Run #4: ActivityRecord&#123;92b068e u0 com.example.sven.activitydemo/.ThirdActivity t135&#125;
    Run #3: ActivityRecord&#123;96bd6b6 u0 com.example.sven.activitydemo/.SecondActivity t135&#125;
    Run #2: ActivityRecord&#123;44bf730 u0 com.example.sven.activitydemo/.MainActivity t135&#125;

TaskRecord&#123;249ecaa #135 A=com.example.sven.activitydemo U=0 sz=2&#125;
    Run #3: ActivityRecord&#123;96bd6b6 u0 com.example.sven.activitydemo/.SecondActivity t135&#125;
    Run #2: ActivityRecord&#123;44bf730 u0 com.example.sven.activitydemo/.MainActivity t135&#125;
</code></pre>
<p>可以看到，如果被启动的SecondActivity的启动模式是SingleTask，那么B会清除实例之上的Activity，并且调用onNewIntent方法</p>
<p><strong>总结：主要2个点，清除被启动Activity之上的实例，是否创建新的实例和被启动Activity的lanuchMode有关</strong></p>
<h3 id="4-Intent-FLAG-ACTIVITY-EXCLUDE-FROM-RECENTS"><a href="#4-Intent-FLAG-ACTIVITY-EXCLUDE-FROM-RECENTS" class="headerlink" title="4. Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS"></a>4. Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</h3><p>具有这个标记的Activity不会出现在历史Activity的记录中，和android:excludeFromRecents作用相同</p>
<h3 id="tips：启动模式有2种设置方法，通过设置Intent的FLAG-和-AndroidManifest-xml-，第一种方式的优先级大于第二种方式"><a href="#tips：启动模式有2种设置方法，通过设置Intent的FLAG-和-AndroidManifest-xml-，第一种方式的优先级大于第二种方式" class="headerlink" title="tips：启动模式有2种设置方法，通过设置Intent的FLAG 和 AndroidManifest.xml ，第一种方式的优先级大于第二种方式"></a>tips：启动模式有2种设置方法，通过设置Intent的FLAG 和 AndroidManifest.xml ，第一种方式的优先级大于第二种方式</h3><h1 id="三、IntentFilter的匹配规则"><a href="#三、IntentFilter的匹配规则" class="headerlink" title="三、IntentFilter的匹配规则"></a>三、IntentFilter的匹配规则</h1><p>Activity的显示调用和隐式调用：<a target="_blank" rel="noopener" href="http://blog.csdn.net/xiao__gui/article/details/11392987">http://blog.csdn.net/xiao__gui/article/details/11392987</a></p>
<p>一个activity可以有多个过滤器，每个过滤器均可以有多个action，category和data</p>
<h2 id="1-action的匹配规则"><a href="#1-action的匹配规则" class="headerlink" title="1.action的匹配规则"></a>1.action的匹配规则</h2><p><strong>Intent 中的 action 只要有一个与过滤器（manifest中的intent-filter）的匹配，就可调用这个过滤器所在的组件。</strong></p>
<h2 id="2-category的匹配规则"><a href="#2-category的匹配规则" class="headerlink" title="2.category的匹配规则"></a>2.category的匹配规则</h2><p>category 表示类别，最常见就是这2个</p>
<pre><code>&lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
 &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
</code></pre>
<p><strong>1. 隐式启动时intent会自动的添加一个默认的category，所以隐式启动时，过滤器中默认的category必须要加</strong></p>
<pre><code> &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;
</code></pre>
<p><strong>2. 隐式启动时，intent中添加的category必须包含在过滤器中</strong></p>
<h2 id="3-data的匹配规则"><a href="#3-data的匹配规则" class="headerlink" title="3.data的匹配规则"></a>3.data的匹配规则</h2><p><strong>data 表示该组件可以支持的数据格式与类型，intent 至少可以匹配过滤器中的一个</strong></p>
<p>主要由两部分组成：1.mimeType 2.URI ，语法如下：</p>
<pre><code>&lt;data android:scheme=&quot;string&quot;
    android:host=&quot;string&quot;
    android:port=&quot;string&quot;
    android:path=&quot;string&quot;
    android:pathPattern=&quot;string&quot;
    android:pathPrefix=&quot;string&quot;
    android:mimeType=&quot;string&quot; /&gt;
</code></pre>
<p>(1) mimeType 指的是支持的数据类型与格式<br>    常见的有：1.text/plain 2.image/jpeg 3.video/* 4.audio/*<br>    / 号前面的是数据类型，后面是具体格式。</p>
<p>(2) URI 格式：</p>
<pre><code>&lt;scheme&gt;://&lt;host&gt;:&lt;port&gt;/[&lt;path&gt;]|[&lt;pathPrefix&gt;]|[pathPattern]
</code></pre>
<p>1.scheme、host、port、path分别表示URI的模式、主机名和端口号和路径</p>
<pre><code>例如：http://www.baidu.com:80/search/info
</code></pre>
<p>2.如果scheme或者host未指定那么URI就无效</p>
<p>3.URI 是有默认值的，content 和 file，这里不是很理解，不过发现这样一种情况：</p>
<p>在intent-filter 中添加任意一种mimeType，不指定URI</p>
<pre><code>&lt;data android:mimeType=&quot;image/jpeg&quot;/&gt;
</code></pre>
<p>intent启动时，设置URI为 content:.* 或 file:.* 均可启动</p>
<pre><code>intent.setDataAndType(Uri.parse(&quot;content://abc&quot;), &quot;image/jpeg&quot;);
</code></pre>
<p>4.data 是有如下2种写法的，效果是一样的</p>
<pre><code>&lt;data android:scheme=&quot;file&quot;
      android:host=&quot;abc&quot;
      android:mimeType=&quot;text/plain&quot;/&gt;

&lt;data android:scheme=&quot;file&quot;/&gt;
&lt;data android:host=&quot;abc&quot;/&gt;
&lt;data android:mimeType=&quot;text/plain&quot;/&gt;
</code></pre>
<p>如果一个intent-filter 中有多个data 并且他们的URI均不同，建议用第一种。</p>
<p>data 的匹配规则这里只列举的常用的一部分，还有些情况类似与如下，也可以匹配到，可以将URI 和MIMETYPE的关系理解为action和category的关系</p>
<pre><code>&lt;data android:scheme=&quot;http&quot; android:host=&quot;abc&quot; android:mimeType=&quot;text/plain&quot;/&gt;
&lt;data android:scheme=&quot;http&quot; android:host=&quot;abc2&quot; android:mimeType=&quot;image/png&quot;/&gt;

intent.setDataAndType(Uri.parse(&quot;http://abc&quot;), &quot;image/png&quot;);
</code></pre>
<p>只能理解为 URI 和MIMETYPE 其实类似于 action 和 category的关系，采用如下的写法更能表现两者的关系，具体大家在实践中多多理解</p>
<pre><code>  &lt;data android:scheme=&quot;file&quot; android:host=&quot;abc&quot; /&gt;
  &lt;data android:scheme=&quot;file&quot; android:host=&quot;abc2&quot; /&gt;
  &lt;data android:mimeType=&quot;text/plain&quot; /&gt;
  &lt;data android:mimeType=&quot;image/png&quot; /&gt;
</code></pre>
<h3 id="tips-1"><a href="#tips-1" class="headerlink" title="tips:"></a>tips:</h3><p>1.如果要为Intent指定完整的data，必须要调用setDataAndType方法，不能先调用setData然后调用setType，因为这两个方法会彼此清除对方的值。<br>2.当我们启动Activity可以通过resolveActivity判断是否有对应的Activity</p>
<pre><code>if(this.getPackageManager().resolveActivity(intent, 0) != null)&#123;
    startActivity(intent);
&#125;
</code></pre>
<p>3.特殊的一组action和category，标记应用启动时打开的Activity，少了任何一个都没有意义</p>
<pre><code>&lt;intent-filter&gt;
    &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
    &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
&lt;/intent-filter&gt;
</code></pre>
<p>4.显示Component调用也是可以跨应用的，需要显示指定Activity属性 android:exported=”true” 或者添加一个intent-Filter，否则会报AndroidRuntime异常，通过Tip 2是不能检查出intent是否正常。</p>
<p>以上这些自己写了个Demo，方便大家调试和学习：</p>
<p><strong>问题：</strong></p>
<ol>
<li>onSaveInstanceState 为何会在跳转到别的Activity、Home键以及锁屏时调用？</li>
<li>category 和 data 的更多用法？</li>
</ol>
<p><strong>参考资料：</strong><br><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/app/Activity.html">https://developer.android.com/reference/android/app/Activity.html</a><br><a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/activity-element.html?hl=zh-cn#config">https://developer.android.com/guide/topics/manifest/activity-element.html?hl=zh-cn#config</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/u011240877/article/details/71305797">http://blog.csdn.net/u011240877/article/details/71305797</a><br>《Android 开发艺术之旅》</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/22/Notes/Android/FourComponents/Fragment%E5%AD%A6%E4%B9%A0%E7%90%86%E8%A7%A3%E5%8F%8A%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sven.jpeg">
      <meta itemprop="name" content="sven">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sven's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/22/Notes/Android/FourComponents/Fragment%E5%AD%A6%E4%B9%A0%E7%90%86%E8%A7%A3%E5%8F%8A%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-22 22:57:54" itemprop="dateCreated datePublished" datetime="2021-02-22T22:57:54+08:00">2021-02-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文主要介绍下Android Fragment的生命周期，相关的API以及和Activity通信的简单实践</p>
<h1 id="一、生命周期："><a href="#一、生命周期：" class="headerlink" title="一、生命周期："></a>一、生命周期：</h1><p><img src="https://leanote.com/api/file/getImage?fileId=5936c722ab64410e79001e16" alt="fragment生命周期"><br>Fragment创建销毁时，fragment和所依赖的activity生命周期的执行顺序，<strong>注意看log的TAG</strong></p>
<h2 id="1-创建时"><a href="#1-创建时" class="headerlink" title="1.创建时"></a>1.创建时</h2><pre><code>01-12 17:57:24.823 28028-28028/? I/ActivityLife: onCreate...
01-12 17:57:24.843 28028-28028/? I/FragmentLife: onAttach...
01-12 17:57:24.843 28028-28028/? I/FragmentLife: onCreate...
01-12 17:57:24.843 28028-28028/? I/FragmentLife: onCreateView...
01-12 17:57:24.843 28028-28028/? I/FragmentLife: onActivityCreated...
01-12 17:57:24.843 28028-28028/? I/ActivityLife: onStart...
01-12 17:57:24.843 28028-28028/? I/FragmentLife: onStart...
01-12 17:57:24.843 28028-28028/? I/ActivityLife: onResume...
01-12 17:57:24.843 28028-28028/? I/FragmentLife: onResume...
</code></pre>
<h2 id="2-销毁时"><a href="#2-销毁时" class="headerlink" title="2.销毁时"></a>2.销毁时</h2><pre><code>01-12 17:57:40.583 28028-28028/? I/FragmentLife: onPause...
01-12 17:57:40.583 28028-28028/? I/ActivityLife: onPause...
01-12 17:57:40.883 28028-28028/? I/FragmentLife: onStop...
01-12 17:57:40.883 28028-28028/? I/ActivityLife: onStop...
01-12 17:57:40.883 28028-28028/? I/FragmentLife: onDestroyView...
01-12 17:57:40.883 28028-28028/? I/FragmentLife: onDestroy...
01-12 17:57:40.883 28028-28028/? I/FragmentLife: onDetach...
01-12 17:57:40.883 28028-28028/? I/ActivityLife: onDestroy...
</code></pre>
<h1 id="二、Activity中，Fragment的2种加载方法"><a href="#二、Activity中，Fragment的2种加载方法" class="headerlink" title="二、Activity中，Fragment的2种加载方法"></a>二、Activity中，Fragment的2种加载方法</h1><h2 id="1-静态加载"><a href="#1-静态加载" class="headerlink" title="1.静态加载"></a>1.静态加载</h2><h3 id="（1）创建Fragment类和布局文件-fragment1-xml"><a href="#（1）创建Fragment类和布局文件-fragment1-xml" class="headerlink" title="（1）创建Fragment类和布局文件(fragment1.xml)"></a>（1）创建Fragment类和布局文件(fragment1.xml)</h3><pre><code>public class Fragment1 extends Fragment &#123;
    @Override
    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, Bundle savedInstanceState) &#123;
       return inflater.inflate(R.layout.fragment1, container, false);
    &#125;
&#125;

&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:background=&quot;#00ff00&quot; &gt;
    &lt;TextView
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:text=&quot;This is fragment 1&quot;
        android:textColor=&quot;#000000&quot;
        android:textSize=&quot;25sp&quot; /&gt;
&lt;/LinearLayout&gt; 
</code></pre>
<h3 id="（2）在activity布局文件（activity-main-xml）中添加fragment布局"><a href="#（2）在activity布局文件（activity-main-xml）中添加fragment布局" class="headerlink" title="（2）在activity布局文件（activity_main.xml）中添加fragment布局"></a>（2）在activity布局文件（activity_main.xml）中添加fragment布局</h3><pre><code>...
&lt;fragment
android:id=&quot;@+id/fragment1&quot;
android:name=&quot;com.example.sven.fragementdemo.Fragment1&quot;
android:layout_width=&quot;0dip&quot;
android:layout_height=&quot;match_parent&quot;
android:layout_weight=&quot;1&quot; /&gt;
...
</code></pre>
<h2 id="2-动态加载"><a href="#2-动态加载" class="headerlink" title="2.动态加载"></a>2.动态加载</h2><h3 id="1-在activity布局文件中添加FragmentLayout节点"><a href="#1-在activity布局文件中添加FragmentLayout节点" class="headerlink" title="(1) 在activity布局文件中添加FragmentLayout节点"></a>(1) 在activity布局文件中添加FragmentLayout节点</h3><pre><code>...
  &lt;FrameLayout
        android:id=&quot;@+id/fragment_container&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;&gt;
    &lt;/FrameLayout&gt;
...
</code></pre>
<h3 id="2-java代码中动态加载"><a href="#2-java代码中动态加载" class="headerlink" title="(2) java代码中动态加载"></a>(2) java代码中动态加载</h3><pre><code>...
  1.获取fragmentManager
FragmentManager fragmentManager = getFragmentManager();
  2.获取FragmentTransaction
FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();
  3.创建需要的Fragment
Fragment fragment = new Fragment1();
  4.动态添加fragment
    将创建的fragment添加到Activity布局文件中定义的占位符中（FrameLayout）
fragmentTransaction.add(R.id.fragment_container,fragment).commit();
...
</code></pre>
<h1 id="三、FragmentTransaction方法解析结合Fragment的生命周期"><a href="#三、FragmentTransaction方法解析结合Fragment的生命周期" class="headerlink" title="三、FragmentTransaction方法解析结合Fragment的生命周期"></a>三、FragmentTransaction方法解析结合Fragment的生命周期</h1><p>对Fragment的操作主要是通过调用FragmentTransaction类的方法进行的，FragmentTransaction的对象通常是通过getFragmentManager().beginTransaction()获取的</p>
<h2 id="1-add-amp-remove-replace"><a href="#1-add-amp-remove-replace" class="headerlink" title="1.add &amp; remove / replace"></a>1.add &amp; remove / replace</h2><h3 id="1-add-往Activity中添加一个Fragment，对应的fragment的生命周期如下："><a href="#1-add-往Activity中添加一个Fragment，对应的fragment的生命周期如下：" class="headerlink" title="(1) add 往Activity中添加一个Fragment，对应的fragment的生命周期如下："></a>(1) add 往Activity中添加一个Fragment，对应的fragment的生命周期如下：</h3><pre><code>06-13 12:01:43.406 1986-1986/? I/Fragment3: onAttach
06-13 12:01:43.406 1986-1986/? I/Fragment3: onCreate
06-13 12:01:43.406 1986-1986/? I/Fragment3: onCreateView
06-13 12:01:43.406 1986-1986/? I/Fragment3: onActivityCreated
06-13 12:01:43.406 1986-1986/? I/Fragment3: onStart
06-13 12:01:43.406 1986-1986/? I/Fragment3: onResume  
</code></pre>
<h3 id="2-remove-从Activity中移除一个Fragment，和add配对使用，通常是直接用replace"><a href="#2-remove-从Activity中移除一个Fragment，和add配对使用，通常是直接用replace" class="headerlink" title="(2) remove 从Activity中移除一个Fragment，和add配对使用，通常是直接用replace"></a>(2) remove 从Activity中移除一个Fragment，和add配对使用，通常是直接用replace</h3><pre><code>06-13 12:07:54.046 8765-8765/com.example.sven.fragementdemo I/Fragment3: onPause
06-13 12:07:54.046 8765-8765/com.example.sven.fragementdemo I/Fragment3: onStop
06-13 12:07:54.046 8765-8765/com.example.sven.fragementdemo I/Fragment3: onDestroyView
06-13 12:07:54.046 8765-8765/com.example.sven.fragementdemo I/Fragment3: onDestroy
06-13 12:07:54.046 8765-8765/com.example.sven.fragementdemo I/Fragment3: onDetach
</code></pre>
<h3 id="3-replace-使用另一个fragment替换当前的，先remove掉当前的再add新的，参考add和remove的过程"><a href="#3-replace-使用另一个fragment替换当前的，先remove掉当前的再add新的，参考add和remove的过程" class="headerlink" title="(3) replace 使用另一个fragment替换当前的，先remove掉当前的再add新的，参考add和remove的过程"></a>(3) replace 使用另一个fragment替换当前的，先remove掉当前的再add新的，参考add和remove的过程</h3><h2 id="2-attach-amp-detach"><a href="#2-attach-amp-detach" class="headerlink" title="2.attach &amp; detach"></a>2.attach &amp; detach</h2><h3 id="1-attach-重建view视图，添加到UI上并显示，和detach配合使用，显示一个被detach的fragment"><a href="#1-attach-重建view视图，添加到UI上并显示，和detach配合使用，显示一个被detach的fragment" class="headerlink" title="(1) attach 重建view视图，添加到UI上并显示，和detach配合使用，显示一个被detach的fragment"></a>(1) attach 重建view视图，添加到UI上并显示，和detach配合使用，显示一个被detach的fragment</h3><pre><code>06-13 11:57:46.376 29992-29992/com.example.sven.fragementdemo I/Fragment3: onCreateView
06-13 11:57:46.376 29992-29992/com.example.sven.fragementdemo I/Fragment3: onActivityCreated
06-13 11:57:46.376 29992-29992/com.example.sven.fragementdemo I/Fragment3: onStart
06-13 11:57:46.376 29992-29992/com.example.sven.fragementdemo I/Fragment3: onResume
</code></pre>
<h3 id="2-detach-会将view从UI中移除-和remove-不同-此时fragment的状态依然由FragmentManager维护，fragment的实例还存在，但是视图被销毁了"><a href="#2-detach-会将view从UI中移除-和remove-不同-此时fragment的状态依然由FragmentManager维护，fragment的实例还存在，但是视图被销毁了" class="headerlink" title="(2) detach 会将view从UI中移除,和remove()不同,此时fragment的状态依然由FragmentManager维护，fragment的实例还存在，但是视图被销毁了"></a>(2) detach 会将view从UI中移除,和remove()不同,此时fragment的状态依然由FragmentManager维护，fragment的实例还存在，但是视图被销毁了</h3><pre><code>06-13 11:58:13.486 29992-29992/com.example.sven.fragementdemo I/Fragment3: onPause
06-13 11:58:13.486 29992-29992/com.example.sven.fragementdemo I/Fragment3: onStop
06-13 11:58:13.486 29992-29992/com.example.sven.fragementdemo I/Fragment3: onDestroyView
</code></pre>
<h2 id="3-hide-amp-show"><a href="#3-hide-amp-show" class="headerlink" title="3.hide &amp; show"></a>3.hide &amp; show</h2><p>不涉及fragment生命周期，调试过程中没有看到想象中onPause、onStop、onResume函数的调用过程，hide时fragment的视图和实例都不会被销毁，只是视图可见与不可见的变化。账号登陆界面应该用的比较多，能够保存用户的输入，和detach区别就是detach不能够的保存界面的信息（例如EditText的输入），每次detach，attch时界面都会重绘</p>
<h2 id="4-commit"><a href="#4-commit" class="headerlink" title="4.commit"></a>4.commit</h2><p>提交对fragment的一系列操作。注意每一次对fragment的操作都要开一次事务，commit一次。commit和FragmentManager.beginTransaction()要配对使用。（很像数据库，暂时没深入研究）</p>
<h2 id="5-addToBackStack-String"><a href="#5-addToBackStack-String" class="headerlink" title="5.addToBackStack(String)"></a>5.addToBackStack(String)</h2><p>把当前事务的变化情况添加到回退栈,下节详细讲下</p>
<h2 id="tips："><a href="#tips：" class="headerlink" title="tips："></a>tips：</h2><h3 id="1-以上这些方法通常是在Activity中使用，依附于同一个Activity的多个fragment的各种切换"><a href="#1-以上这些方法通常是在Activity中使用，依附于同一个Activity的多个fragment的各种切换" class="headerlink" title="1.以上这些方法通常是在Activity中使用，依附于同一个Activity的多个fragment的各种切换"></a>1.以上这些方法通常是在Activity中使用，依附于同一个Activity的多个fragment的各种切换</h3><h3 id="2-fragment真正的实例其实是要通过FragmentTransaction-add，只有在add时才会执行onCreate，new的时候拿到只是一个引用-并没有执行生命周期函数"><a href="#2-fragment真正的实例其实是要通过FragmentTransaction-add，只有在add时才会执行onCreate，new的时候拿到只是一个引用-并没有执行生命周期函数" class="headerlink" title="2.fragment真正的实例其实是要通过FragmentTransaction.add，只有在add时才会执行onCreate，new的时候拿到只是一个引用 并没有执行生命周期函数"></a>2.fragment真正的实例其实是要通过FragmentTransaction.add，只有在add时才会执行onCreate，new的时候拿到只是一个引用 并没有执行生命周期函数</h3><h3 id="3-使用attach-detach-或者-hide-show-都需要new出对象，并且执行add"><a href="#3-使用attach-detach-或者-hide-show-都需要new出对象，并且执行add" class="headerlink" title="3.使用attach/detach 或者 hide/show 都需要new出对象，并且执行add"></a>3.使用attach/detach 或者 hide/show 都需要new出对象，并且执行add</h3><h3 id="4-add-remove-replace-hide-show后都要commit其效果才会在屏幕上显示出来"><a href="#4-add-remove-replace-hide-show后都要commit其效果才会在屏幕上显示出来" class="headerlink" title="4.add/remove/replace/hide/show后都要commit其效果才会在屏幕上显示出来"></a>4.add/remove/replace/hide/show后都要commit其效果才会在屏幕上显示出来</h3><h1 id="四、Fragment的回退栈"><a href="#四、Fragment的回退栈" class="headerlink" title="四、Fragment的回退栈"></a>四、Fragment的回退栈</h1><p>Fragment回退栈是用来保存每一次Fragment事务发生的变化，如果你将Fragment任务添加到回退栈，当点击back键时，将看到上一次的保存的Fragment，一旦Fragment完全从后退栈中弹出，用户再次点击后退键，则退出当前Activity，如果被移除的Fragment没有添加到回退栈，例如执行remove或者replace时，这个Fragment实例将会被销毁</p>
<p>理解以下3种情况 在同一个Actity中，fragment1 跳转到fragment2，然后按back退出时的不同情况</p>
<pre><code>public void jump2fragment2()&#123;
    FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();
    fragment之间跳转时
    1.只采用replace 实例会被销毁 back键一次
    fragmentTransaction.replace(R.id.fragment_container,new Fragment2());
    fragmentTransaction.addToBackStack(null);

    2.把当前事务的变化情况添加到回退栈,视图会被销毁但是实例还在(back 2次)
    fragmentTransaction.replace(R.id.fragment_container,new Fragment2());
    fragmentTransaction.addToBackStack(null);

    3.采用hide方式 实例不会被销毁,视图也不会被销毁(back 2次)
    fragmentTransaction.hide(this);
    fragmentTransaction.add(R.id.fragment_container, new Fragment2());
    fragmentTransaction.addToBackStack(null);
    fragmentTransaction.commit();
&#125;
</code></pre>
<h1 id="五、Fragment与Activity之间的通信"><a href="#五、Fragment与Activity之间的通信" class="headerlink" title="五、Fragment与Activity之间的通信"></a>五、Fragment与Activity之间的通信</h1><h2 id="1-一般Fragment依附于Activity存在，因此与Activity之间的通信可以归纳为以下3点："><a href="#1-一般Fragment依附于Activity存在，因此与Activity之间的通信可以归纳为以下3点：" class="headerlink" title="1.一般Fragment依附于Activity存在，因此与Activity之间的通信可以归纳为以下3点："></a>1.一般Fragment依附于Activity存在，因此与Activity之间的通信可以归纳为以下3点：</h2><h3 id="（1）Fragment中可以通过getActivity得到当前绑定的Activity的实例，然后进行操作"><a href="#（1）Fragment中可以通过getActivity得到当前绑定的Activity的实例，然后进行操作" class="headerlink" title="（1）Fragment中可以通过getActivity得到当前绑定的Activity的实例，然后进行操作"></a>（1）Fragment中可以通过getActivity得到当前绑定的Activity的实例，然后进行操作</h3><p>例如你在想在某个fragment中通过activity拿到fragment1的数据可以这样做</p>
<pre><code>public void getfragment1text() &#123;
    getActivity().findViewById(R.id.fragment1_text)
&#125;
</code></pre>
<h3 id="2-如果你Activity中包含自己管理的Fragment的引用，可以通过引用直接访问所有的Fragment的public方法"><a href="#2-如果你Activity中包含自己管理的Fragment的引用，可以通过引用直接访问所有的Fragment的public方法" class="headerlink" title="(2) 如果你Activity中包含自己管理的Fragment的引用，可以通过引用直接访问所有的Fragment的public方法"></a>(2) 如果你Activity中包含自己管理的Fragment的引用，可以通过引用直接访问所有的Fragment的public方法</h3><h3 id="3-如果Activity中未保存任何Fragment的引用，那么没关系，每个Fragment都有一个唯一的TAG或者ID-可以通过getFragmentManager-findFragmentByTag-或者findFragmentById-获得任何Fragment实例，然后进行操作-fragment的id其实是无法设置的，add或replace时设置的id是其实要插入fragment所在ViewGroup的id，tag可以在add或replace时设置。https-stackoverflow-com-questions-9363072-android-set-fragment-id"><a href="#3-如果Activity中未保存任何Fragment的引用，那么没关系，每个Fragment都有一个唯一的TAG或者ID-可以通过getFragmentManager-findFragmentByTag-或者findFragmentById-获得任何Fragment实例，然后进行操作-fragment的id其实是无法设置的，add或replace时设置的id是其实要插入fragment所在ViewGroup的id，tag可以在add或replace时设置。https-stackoverflow-com-questions-9363072-android-set-fragment-id" class="headerlink" title="(3) 如果Activity中未保存任何Fragment的引用，那么没关系，每个Fragment都有一个唯一的TAG或者ID,可以通过getFragmentManager.findFragmentByTag()或者findFragmentById()获得任何Fragment实例，然后进行操作 fragment的id其实是无法设置的，add或replace时设置的id是其实要插入fragment所在ViewGroup的id，tag可以在add或replace时设置。https://stackoverflow.com/questions/9363072/android-set-fragment-id"></a>(3) 如果Activity中未保存任何Fragment的引用，那么没关系，每个Fragment都有一个唯一的TAG或者ID,可以通过getFragmentManager.findFragmentByTag()或者findFragmentById()获得任何Fragment实例，然后进行操作 fragment的id其实是无法设置的，add或replace时设置的id是其实要插入fragment所在ViewGroup的id，tag可以在add或replace时设置。<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9363072/android-set-fragment-id">https://stackoverflow.com/questions/9363072/android-set-fragment-id</a></h3><pre><code>public class MainActivity extends AppCompatActivity &#123;
    private static final String TAG = &quot;ActivityLife&quot;;
    private Fragment1 fragment = new Fragment1();
    @Override
    protected void onCreate(Bundle savedInstanceState) &#123;
        super.onCreate(savedInstanceState);
        printLog(&quot;onCreate...&quot;);
        setContentView(R.layout.activity_main);

        // 1.获取fragmentManager
        FragmentManager fragmentManager = getFragmentManager();
        // 2.获取FragmentTransaction
        FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();
        // 3.创建需要的Fragment
        // Fragment fragment = new Fragment1();
        // 4.动态添加fragment
        // 将创建的fragment添加到Activity布局文件中定义的占位符中（FrameLayout）
        fragmentTransaction.add(R.id.fragment_container, fragment, &quot;fragment1&quot;).commit();
    &#125;

    public void getFragmentMessage(View view)&#123;
        //1.针对第2种情况
        fragment.printSth();
        //2.针对第3种情况
        Fragment fragment = getFragmentManager().findFragmentByTag(&quot;fragment1&quot;);
        printLog(fragment.toString());
        fragment.onResume();
    &#125;
&#125;

public class Fragment1 extends Fragment &#123;
    ...
    public void printSth() &#123;
        Log.i(TAG,&quot;fragment3 printSth&quot;);
    &#125;
&#125;
</code></pre>
<h3 id="（4）更复杂的用法参考："><a href="#（4）更复杂的用法参考：" class="headerlink" title="（4）更复杂的用法参考："></a>（4）更复杂的用法参考：</h3><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/lmj623565791/article/details/37992017">http://blog.csdn.net/lmj623565791/article/details/37992017</a></p>
<h2 id="2-应用场景主要就是通过Activity去管理多个Fragment的状态"><a href="#2-应用场景主要就是通过Activity去管理多个Fragment的状态" class="headerlink" title="2.应用场景主要就是通过Activity去管理多个Fragment的状态"></a>2.应用场景主要就是通过Activity去管理多个Fragment的状态</h2><h2 id="思路如下："><a href="#思路如下：" class="headerlink" title="思路如下："></a>思路如下：</h2><h3 id="1-让各个Fragment注册一个监听接口，让Activity去implements这个监听接口"><a href="#1-让各个Fragment注册一个监听接口，让Activity去implements这个监听接口" class="headerlink" title="(1) 让各个Fragment注册一个监听接口，让Activity去implements这个监听接口"></a>(1) 让各个Fragment注册一个监听接口，让Activity去implements这个监听接口</h3><h3 id="2-在Activity中new出各个Fragment的对象，获取引用"><a href="#2-在Activity中new出各个Fragment的对象，获取引用" class="headerlink" title="(2) 在Activity中new出各个Fragment的对象，获取引用"></a>(2) 在Activity中new出各个Fragment的对象，获取引用</h3><h3 id="3-将Fragment中的事件通过listener传递到Activity中，在Fragment中通过getActivity去调用监听方法"><a href="#3-将Fragment中的事件通过listener传递到Activity中，在Fragment中通过getActivity去调用监听方法" class="headerlink" title="(3) 将Fragment中的事件通过listener传递到Activity中，在Fragment中通过getActivity去调用监听方法"></a>(3) 将Fragment中的事件通过listener传递到Activity中，在Fragment中通过getActivity去调用监听方法</h3><h2 id="tips"><a href="#tips" class="headerlink" title="tips:"></a>tips:</h2><h3 id="Fragment中的按钮的事件响应时不能通过在配置文件中加onClick属性找到的，必须注册onClickListenr-有2种方式"><a href="#Fragment中的按钮的事件响应时不能通过在配置文件中加onClick属性找到的，必须注册onClickListenr-有2种方式" class="headerlink" title="Fragment中的按钮的事件响应时不能通过在配置文件中加onClick属性找到的，必须注册onClickListenr(有2种方式)"></a>Fragment中的按钮的事件响应时不能通过在配置文件中加onClick属性找到的，必须注册onClickListenr(有2种方式)</h3><p>原因参考：<a target="_blank" rel="noopener" href="http://blog.csdn.net/Zafir6453/article/details/51383915">http://blog.csdn.net/Zafir6453/article/details/51383915</a></p>
<h2 id="3-以上这些自己写了个Demo，方便大家调试和学习"><a href="#3-以上这些自己写了个Demo，方便大家调试和学习" class="headerlink" title="3.以上这些自己写了个Demo，方便大家调试和学习"></a>3.以上这些自己写了个Demo，方便大家调试和学习</h2><p><a target="_blank" rel="noopener" href="http://download.csdn.net/detail/time_traveller14/9870932">http://download.csdn.net/detail/time_traveller14/9870932</a></p>
<h3 id="1-生命周期，回退栈，参考fragment1-fragment2-MainActivity"><a href="#1-生命周期，回退栈，参考fragment1-fragment2-MainActivity" class="headerlink" title="1.生命周期，回退栈，参考fragment1,fragment2,MainActivity"></a>1.生命周期，回退栈，参考fragment1,fragment2,MainActivity</h3><h3 id="2-FragmentTransaction及和Activity通信（fragment中不同的按钮事件响应）-参考fragment3-fragment4-Main2Activity"><a href="#2-FragmentTransaction及和Activity通信（fragment中不同的按钮事件响应）-参考fragment3-fragment4-Main2Activity" class="headerlink" title="2.FragmentTransaction及和Activity通信（fragment中不同的按钮事件响应） 参考fragment3,fragment4, Main2Activity"></a>2.FragmentTransaction及和Activity通信（fragment中不同的按钮事件响应） 参考fragment3,fragment4, Main2Activity</h3><h1 id="六-还未理解问题："><a href="#六-还未理解问题：" class="headerlink" title="六.还未理解问题："></a>六.还未理解问题：</h1><h3 id="1-回退栈的使用场景，有了hide和detach为何还要加这个，仅仅是为了多按一次back键？"><a href="#1-回退栈的使用场景，有了hide和detach为何还要加这个，仅仅是为了多按一次back键？" class="headerlink" title="1.回退栈的使用场景，有了hide和detach为何还要加这个，仅仅是为了多按一次back键？"></a>1.回退栈的使用场景，有了hide和detach为何还要加这个，仅仅是为了多按一次back键？</h3><h3 id="2-hide和show为何没有onPause和onResume的过程，hide为何不执行onPause，onStop呢？"><a href="#2-hide和show为何没有onPause和onResume的过程，hide为何不执行onPause，onStop呢？" class="headerlink" title="2.hide和show为何没有onPause和onResume的过程，hide为何不执行onPause，onStop呢？"></a>2.hide和show为何没有onPause和onResume的过程，hide为何不执行onPause，onStop呢？</h3><h3 id="3-remove-的真正含义销毁还是出栈，看许多资料解释是销毁掉，但为何remove掉，commit完fragment-null，还能够通过tag获取到，但是去寻找fragment的视图元素会报错？"><a href="#3-remove-的真正含义销毁还是出栈，看许多资料解释是销毁掉，但为何remove掉，commit完fragment-null，还能够通过tag获取到，但是去寻找fragment的视图元素会报错？" class="headerlink" title="3.remove 的真正含义销毁还是出栈，看许多资料解释是销毁掉，但为何remove掉，commit完fragment!=null，还能够通过tag获取到，但是去寻找fragment的视图元素会报错？"></a>3.remove 的真正含义销毁还是出栈，看许多资料解释是销毁掉，但为何remove掉，commit完fragment!=null，还能够通过tag获取到，但是去寻找fragment的视图元素会报错？</h3><h3 id="4-屏幕旋转时，已经判断了onSavedInstance-null，为何还会继续，log中-onCreate-onCreateView会执行，要结合activity？"><a href="#4-屏幕旋转时，已经判断了onSavedInstance-null，为何还会继续，log中-onCreate-onCreateView会执行，要结合activity？" class="headerlink" title="4.屏幕旋转时，已经判断了onSavedInstance==null，为何还会继续，log中 onCreate onCreateView会执行，要结合activity？"></a>4.屏幕旋转时，已经判断了onSavedInstance==null，为何还会继续，log中 onCreate onCreateView会执行，要结合activity？</h3><h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/fragments.html">https://developer.android.com/guide/components/fragments.html</a><br>郭霖大神 <a target="_blank" rel="noopener" href="http://blog.csdn.net/guolin_blog/article/details/8881711">http://blog.csdn.net/guolin_blog/article/details/8881711</a><br>鸿洋大神 <a target="_blank" rel="noopener" href="http://blog.csdn.net/lmj623565791/article/details/37970961">http://blog.csdn.net/lmj623565791/article/details/37970961</a></p>
<h3 id="自己的第一篇技术博客，请大家多多指教，最后不理解的问题，欢迎讨论！"><a href="#自己的第一篇技术博客，请大家多多指教，最后不理解的问题，欢迎讨论！" class="headerlink" title="自己的第一篇技术博客，请大家多多指教，最后不理解的问题，欢迎讨论！"></a>自己的第一篇技术博客，请大家多多指教，最后不理解的问题，欢迎讨论！</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/07/Notes/SoftGrowth/%E9%9D%9E%E6%9A%B4%E5%8A%9B%E6%B2%9F%E9%80%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sven.jpeg">
      <meta itemprop="name" content="sven">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sven's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/07/Notes/SoftGrowth/%E9%9D%9E%E6%9A%B4%E5%8A%9B%E6%B2%9F%E9%80%9A/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-07 21:52:52" itemprop="dateCreated datePublished" datetime="2020-12-07T21:52:52+08:00">2020-12-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="非暴力沟通"><a href="#非暴力沟通" class="headerlink" title="非暴力沟通"></a>非暴力沟通</h1><h2 id="一、非暴力沟通模式"><a href="#一、非暴力沟通模式" class="headerlink" title="一、非暴力沟通模式"></a>一、非暴力沟通模式</h2><h2 id="1、诚实的表达自己，而不批评指责"><a href="#1、诚实的表达自己，而不批评指责" class="headerlink" title="1、诚实的表达自己，而不批评指责"></a>1、诚实的表达自己，而不批评指责</h2><h4 id="（1）观察"><a href="#（1）观察" class="headerlink" title="（1）观察"></a>（1）观察</h4><p> 我所观察（看、听、回忆、想）到的有助于（或无助于）我的福祉的具体行为：</p>
<p>“当我看、听、回忆、想到、听到 …”  </p>
<h4 id="（2）感受"><a href="#（2）感受" class="headerlink" title="（2）感受"></a>（2）感受</h4><p>对于这些行为，我有什么感受（情感而非思想）：</p>
<p>“我感到 …”</p>
<h4 id="（3-需要"><a href="#（3-需要" class="headerlink" title="（3)  需要"></a>（3)  需要</h4><p>什么样的需要或者价值（而非偏好或某种具体的行为）导致我那样的感受：</p>
<p>“因为我需要/看重…”</p>
<h4 id="（4）请求"><a href="#（4）请求" class="headerlink" title="（4）请求"></a>（4）请求</h4><p>清楚的请求（而非命令）那些能丰富我生命的具体行为，</p>
<p>“你是否愿意 …?”</p>
<h3 id="2、关切的倾听他人、而不解读为批评或指责"><a href="#2、关切的倾听他人、而不解读为批评或指责" class="headerlink" title="2、关切的倾听他人、而不解读为批评或指责"></a>2、关切的倾听他人、而不解读为批评或指责</h3><h4 id="（1）观察-1"><a href="#（1）观察-1" class="headerlink" title="（1）观察"></a>（1）观察</h4><p>你所观察（看、听、回忆、想）到的有助于（或无助于）我的福祉的具体行为：</p>
<p>“当你看、听、回忆、想到、听到 …”  </p>
<h4 id="（2）感受-1"><a href="#（2）感受-1" class="headerlink" title="（2）感受"></a>（2）感受</h4><p>对于这些行为，你有什么感受（情感而非思想）：</p>
<p>“你感到 …吗？”</p>
<h4 id="（3）需要"><a href="#（3）需要" class="headerlink" title="（3）需要"></a>（3）需要</h4><p>什么样的需要或者价值（而非偏好或某种具体的行为）导致你那样的感受：</p>
<p>“因为你需要/看重…”</p>
<h4 id="（4）需要"><a href="#（4）需要" class="headerlink" title="（4）需要"></a>（4）需要</h4><p>关注倾听那些能丰富你生命的具体请求，而不解读为命令：</p>
<p>“所以，你想..“</p>
<h2 id="二、培育对自己的爱"><a href="#二、培育对自己的爱" class="headerlink" title="二、培育对自己的爱"></a>二、培育对自己的爱</h2><h3 id="非暴力最重要的应用在于培育对自己的爱"><a href="#非暴力最重要的应用在于培育对自己的爱" class="headerlink" title="非暴力最重要的应用在于培育对自己的爱"></a>非暴力最重要的应用在于培育对自己的爱</h3><ol>
<li>评价自己的行为时，专注于尚未满足的需要，不要依赖羞愧，内疚或沮丧的心理来寻求改变的而让爱主导我们的学习和成长。</li>
<li>根据自己的需要和价值观来选择生活。我们的行为不再是为了履行职责、获得回报、逃避惩罚或避免内心愧疚和羞愧。</li>
<li>用选择做代替不得不，我们的生活将变得充满和谐和快乐。</li>
</ol>
<h2 id="三、充分表达愤怒"><a href="#三、充分表达愤怒" class="headerlink" title="三、充分表达愤怒"></a>三、充分表达愤怒</h2><h3 id="（1）停下来，什么都不做"><a href="#（1）停下来，什么都不做" class="headerlink" title="（1）停下来，什么都不做"></a>（1）停下来，什么都不做</h3><h3 id="（2）想一想什么使我们生气了"><a href="#（2）想一想什么使我们生气了" class="headerlink" title="（2）想一想什么使我们生气了"></a>（2）想一想什么使我们生气了</h3><h3 id="（3）体会自己的需要"><a href="#（3）体会自己的需要" class="headerlink" title="（3）体会自己的需要"></a>（3）体会自己的需要</h3><h3 id="（4）表达自己的感受和需要"><a href="#（4）表达自己的感受和需要" class="headerlink" title="（4）表达自己的感受和需要"></a>（4）表达自己的感受和需要</h3><p>在第三和第四步之间，需要先倾听他人。在得到倾听和理解之后，他们就可以静下心来体会我们的感受和需要了。</p>
<h2 id="四、表达感激"><a href="#四、表达感激" class="headerlink" title="四、表达感激"></a>四、表达感激</h2><h4 id="（1）对方做了什么事情使我们的生活得到了改善"><a href="#（1）对方做了什么事情使我们的生活得到了改善" class="headerlink" title="（1）对方做了什么事情使我们的生活得到了改善;"></a>（1）对方做了什么事情使我们的生活得到了改善;</h4><h4 id="（2）我们有哪些需要得到了满足"><a href="#（2）我们有哪些需要得到了满足" class="headerlink" title="（2）我们有哪些需要得到了满足;"></a>（2）我们有哪些需要得到了满足;</h4><h4 id="（3）我们的心情怎么样？"><a href="#（3）我们的心情怎么样？" class="headerlink" title="（3）我们的心情怎么样？"></a>（3）我们的心情怎么样？</h4>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="sven"
      src="/images/sven.jpeg">
  <p class="site-author-name" itemprop="name">sven</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhaoxiaowen-sven" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhaoxiaowen-sven" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhaoxiaowen-sven@gmail.com" title="E-Mail → mailto:zhaoxiaowen-sven@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sven</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
